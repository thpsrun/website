{% extends "admin/base_site.html" %}
{% load i18n %}

{% block title %}Manage Ordering - {{ game.name }}{% endblock %}

{% block content %}
<h2>Category, Level &amp; Variable Value Ordering: {{ game.name }}</h2>
<p>
    Use the arrow buttons to reorder items. Items with an explicit order (&ge; 1) sort first.
    Items at order 0 (shown dimmed at the bottom of each section) fall back to alphabetical order
    in the API. Variable value ordering is scoped per variable.
</p>

{% if messages %}
<ul class="messagelist">
    {% for message in messages %}
    <li class="{{ message.tags }}">{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}

<h3>Full-Game Categories</h3>
{% if categories %}
<table style="border-collapse: collapse; width: 100%; max-width: 620px;">
    <thead>
        <tr>
            <th style="text-align: left; padding: 8px; border-bottom: 2px solid var(--hairline-color);">Category</th>
            <th style="text-align: center; padding: 8px; border-bottom: 2px solid var(--hairline-color); width: 70px;">Order</th>
            <th style="text-align: center; padding: 8px; border-bottom: 2px solid var(--hairline-color); width: 90px;">Move</th>
        </tr>
    </thead>
    <tbody>
        {% for category in categories %}
        <tr {% if category.order == 0 %}style="opacity: 0.6;"{% endif %}>
            <td style="padding: 8px;">
                {{ category.name }}
                {% if category.order == 0 %}<span style="color: var(--quiet-link-fg); font-size: 0.8em;">(unordered)</span>{% endif %}
            </td>
            <td style="text-align: center; padding: 8px;">{{ category.order }}</td>
            <td style="text-align: center; padding: 8px; white-space: nowrap;">
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="item_id" value="{{ category.id }}">
                    <input type="hidden" name="item_type" value="category">
                    <input type="hidden" name="direction" value="up">
                    <button type="submit" {% if forloop.first %}disabled{% endif %} style="padding: 2px 8px; cursor: pointer;">&#8593;</button>
                </form>
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="item_id" value="{{ category.id }}">
                    <input type="hidden" name="item_type" value="category">
                    <input type="hidden" name="direction" value="down">
                    <button type="submit" {% if forloop.last %}disabled{% endif %} style="padding: 2px 8px; cursor: pointer;">&#8595;</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p><em>No Full-Game Categories.</em></p>
{% endif %}

<h3 style="margin-top: 30px;">Individual Level Categories</h3>
{% if levels %}
<table style="border-collapse: collapse; width: 100%; max-width: 620px;">
    <thead>
        <tr>
            <th style="text-align: left; padding: 8px; border-bottom: 2px solid var(--hairline-color);">Level</th>
            <th style="text-align: center; padding: 8px; border-bottom: 2px solid var(--hairline-color); width: 70px;">Order</th>
            <th style="text-align: center; padding: 8px; border-bottom: 2px solid var(--hairline-color); width: 90px;">Move</th>
        </tr>
    </thead>
    <tbody>
        {% for level in levels %}
        <tr {% if level.order == 0 %}style="opacity: 0.6;"{% endif %}>
            <td style="padding: 8px;">
                {{ level.name }}
                {% if level.order == 0 %}<span style="color: var(--quiet-link-fg); font-size: 0.8em;">(unordered)</span>{% endif %}
            </td>
            <td style="text-align: center; padding: 8px;">{{ level.order }}</td>
            <td style="text-align: center; padding: 8px; white-space: nowrap;">
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="item_id" value="{{ level.id }}">
                    <input type="hidden" name="item_type" value="level">
                    <input type="hidden" name="direction" value="up">
                    <button type="submit" {% if forloop.first %}disabled{% endif %} style="padding: 2px 8px; cursor: pointer;">&#8593;</button>
                </form>
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="item_id" value="{{ level.id }}">
                    <input type="hidden" name="item_type" value="level">
                    <input type="hidden" name="direction" value="down">
                    <button type="submit" {% if forloop.last %}disabled{% endif %} style="padding: 2px 8px; cursor: pointer;">&#8595;</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p><em>No IL Categories.</em></p>
{% endif %}

<h3 style="margin-top: 30px;">Variable:Values Ordering</h3>
{% if variable_groups %}
{% for group in variable_groups %}
<h4 style="margin-top: 20px; margin-bottom: 4px;">
    {{ group.variable.name }}
    <span style="color: var(--quiet-link-fg); font-size: 0.85em; font-weight: normal;">({{ group.variable.scope }})</span>
</h4>
<table style="border-collapse: collapse; width: 100%; max-width: 620px;">
    <thead>
        <tr>
            <th style="text-align: left; padding: 6px 8px; border-bottom: 1px solid var(--hairline-color);">Value</th>
            <th style="text-align: center; padding: 6px 8px; border-bottom: 1px solid var(--hairline-color); width: 70px;">Order</th>
            <th style="text-align: center; padding: 6px 8px; border-bottom: 1px solid var(--hairline-color); width: 90px;">Move</th>
        </tr>
    </thead>
    <tbody>
        {% for vv in group.values %}
        <tr {% if vv.order == 0 %}style="opacity: 0.6;"{% endif %}>
            <td style="padding: 6px 8px;">
                {{ vv.name }}
                {% if vv.order == 0 %}<span style="color: var(--quiet-link-fg); font-size: 0.8em;">(unordered)</span>{% endif %}
            </td>
            <td style="text-align: center; padding: 6px 8px;">{{ vv.order }}</td>
            <td style="text-align: center; padding: 6px 8px; white-space: nowrap;">
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="item_id" value="{{ vv.value }}">
                    <input type="hidden" name="item_type" value="variable_value">
                    <input type="hidden" name="var_id" value="{{ group.variable.id }}">
                    <input type="hidden" name="direction" value="up">
                    <button type="submit" {% if forloop.first %}disabled{% endif %} style="padding: 2px 8px; cursor: pointer;">&#8593;</button>
                </form>
                <form method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="item_id" value="{{ vv.value }}">
                    <input type="hidden" name="item_type" value="variable_value">
                    <input type="hidden" name="var_id" value="{{ group.variable.id }}">
                    <input type="hidden" name="direction" value="down">
                    <button type="submit" {% if forloop.last %}disabled{% endif %} style="padding: 2px 8px; cursor: pointer;">&#8595;</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endfor %}
{% else %}
<p><em>No Variable:Value pairs.</em></p>
{% endif %}

<br>
<a href="{% url 'admin:srl_games_changelist' %}">&#8592; Back to Games</a>
{% endblock %}
